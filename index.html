<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advocate Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-size: 16px;
            background-color: #f5f4f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding-bottom: 60px;
            color: #000;
            transition: background-color 0.3s;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .hover-scale {
            transition: transform 0.3s;
        }
        .hover-scale:hover {
            transform: scale(1.05);
        }
        .click-pulse {
            animation: pulse 0.3s ease-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .card {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        .case-item {
            cursor: pointer;
        }
        .case-item:hover {
            background: #f8f9fa;
        }
        .status-active {
            background-color: #d4edda;
            color: #155724;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .details-section, .hearings-section {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            margin-right: 10px;
        }
        .button-red {
            background: #dc3545;
        }
        input[type="date"], input[type="time"] {
            color: #000;
        }
        input[type="date"]::-webkit-datetime-edit,
        input[type="time"]::-webkit-datetime-edit,
        input[type="date"]::-webkit-inner-spin-button,
        input[type="time"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-clear-button,
        input[type="time"]::-webkit-clear-button {
            color: #000;
        }
        input[type="date"]:focus, input[type="time"]:focus {
            color: #000;
        }
        nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #075e54;
            z-index: 20;
        }
        header {
            background: #075e54;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        .premium-icon {
            width: 1.5em;
            height: 1.5em;
            fill: currentColor;
            transition: transform 0.2s, filter 0.2s;
        }
        .premium-icon:hover {
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.7));
            transform: scale(1.1);
        }
        button .premium-icon:active {
            animation: pulse 0.3s ease-out;
        }
        .tab-button {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: border-color 0.3s;
        }
        .tab-button.active {
            border-bottom-color: #075e54;
            font-weight: bold;
        }
        .label-above {
            font-weight: bold;
            margin-bottom: 4px;
            color: #333;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="min-h-screen flex flex-col" id="body">
    <!-- Header -->
    <header class="bg-green-700 text-white p-4 flex items-center shadow-md fade-in">
        <i class="fas fa-user-tie premium-icon"></i>
        <h1 class="text-2xl font-bold">Advocate Assistant</h1>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4">
        <!-- Home Page: Case History -->
        <div id="homePage" class="bg-white p-6 rounded-lg shadow-md slide-up">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-history premium-icon"></i>
                Case History
            </h2>
            <div class="mb-4 flex space-x-4">
                <button class="tab-button" onclick="filterCases('active')">Active Cases</button>
                <button class="tab-button" onclick="filterCases('closed')">Closed Cases</button>
                <button class="tab-button" onclick="filterCases('all')">All Cases</button>
            </div>
            <div id="caseList" class="space-y-4"></div>
        </div>

        <!-- Case Details Page -->
        <div id="caseDetailsPage" class="hidden bg-white p-6 rounded-lg shadow-md slide-up">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-info-circle premium-icon"></i>
                Case Details
            </h2>
            <div id="caseDetailsContent" class="space-y-4"></div>
            <div class="details-section" id="caseDetailsExtra">
                <h3 class="text-lg font-medium">Details</h3>
                <p><strong>Created on:</strong> <span id="createdOn"></span></p>
                <p><strong>Last updated:</strong> <span id="lastUpdated"></span></p>
            </div>
            <div class="hearings-section" id="hearingsSection">
                <h3 class="text-lg font-medium">Hearings</h3>
                <p id="noHearings">No hearings recorded yet. Add one to track the progress of the case.</p>
                <div id="hearingList" class="space-y-2"></div>
                <button onclick="addHearing()" class="button mt-2">+ Add Hearing</button>
            </div>
            <div class="mt-4 flex space-x-2">
                <a href="#" onclick="editCaseFromDetails()" class="button hover-scale">
                    <i class="fas fa-edit premium-icon"></i>
                    Edit
                </a>
                <a href="#" onclick="deleteCaseFromDetails()" class="button button-red hover-scale">
                    <i class="fas fa-trash-alt premium-icon"></i>
                    Delete
                </a>
                <button onclick="showPage('homePage')" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 hover-scale flex items-center">
                    <i class="fas fa-arrow-left premium-icon"></i>
                    Back
                </button>
            </div>
        </div>

        <!-- Workbook Section -->
        <div id="workbookPage" class="hidden bg-white p-6 rounded-lg shadow-md slide-up">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-book premium-icon"></i>
                Case Workbook
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="label-above">Case Title</label>
                    <input id="caseTitle" type="text" placeholder="Case Title" class="border p-2 rounded w-full">
                </div>
                <div>
                    <label class="label-above">Case Number</label>
                    <input id="caseNumber" type="text" placeholder="Case Number" class="border p-2 rounded w-full">
                </div>
                <div>
                    <label class="label-above">Court</label>
                    <input id="court" type="text" placeholder="Court" class="border p-2 rounded w-full">
                </div>
                <div>
                    <label class="label-above">Client Name</label>
                    <input id="clientName" type="text" placeholder="Client Name" class="border p-2 rounded w-full">
                </div>
                <div>
                    <label class="label-above">Case Date</label>
                    <input id="caseDate" type="date" class="border p-2 rounded w-full" onfocus="this.placeholder=''" onblur="this.placeholder='Case Date'">
                </div>
                <div>
                    <label class="label-above">Status</label>
                    <select id="caseStatus" class="border p-2 rounded w-full">
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Closed">Closed</option>
                    </select>
                </div>
                <div>
                    <label class="label-above">Next Hearing Date</label>
                    <input id="nextHearing" type="date" class="border p-2 rounded w-full" onfocus="this.placeholder=''" onblur="this.placeholder='Next Hearing Date'">
                </div>
                <div>
                    <label class="label-above">Hearing Time</label>
                    <input id="hearingTime" type="time" class="border p-2 rounded w-full" onfocus="this.placeholder=''" onblur="this.placeholder='Hearing Time'">
                </div>
                <div class="md:col-span-2">
                    <label class="label-above">Case Description</label>
                    <textarea id="caseDescription" placeholder="Case Description" class="border p-2 rounded w-full h-24"></textarea>
                </div>
                <div class="md:col-span-2">
                    <label class="label-above">Documents</label>
                    <input id="caseDocuments" type="file" multiple class="border p-2 rounded w-full">
                </div>
            </div>
            <button onclick="addCase()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 hover-scale flex items-center">
                <i class="fas fa-plus premium-icon"></i>
                Add Case
            </button>
        </div>

        <!-- AI Case Assistant Section -->
        <div id="assistantPage" class="hidden bg-white p-6 rounded-lg shadow-md slide-up">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-robot premium-icon"></i>
                AI Case Assistant
            </h2>
            <div class="chat-container" id="chatBox"></div>
            <div class="input-area">
                <textarea id="chatInput" placeholder="Type your message or case details..." class="border p-2 rounded w-full resize-none focus:outline-none focus:ring-2 focus:ring-green-500" rows="2"></textarea>
                <button onclick="sendMessage()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 hover-scale flex items-center">
                    <i class="fas fa-paper-plane premium-icon"></i>
                    Send
                </button>
            </div>
            <div class="old-chats mt-4">
                <h3 class="text-md font-semibold mb-2">Old Chats</h3>
                <div id="oldChatsList"></div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="hidden bg-white p-6 rounded-lg shadow-md slide-up">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-cog premium-icon"></i>
                Settings
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block mb-2">Language:</label>
                    <select id="language" class="border p-2 rounded w-full" onchange="changeLanguage()">
                        <option value="en">English</option>
                        <option value="hi">हिन्दी</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2">Theme:</label>
                    <select id="theme" class="border p-2 rounded w-full" onchange="changeTheme()">
                        <option value="gray">Gray</option>
                        <option value="white">White</option>
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                        <option value="orange">Orange</option>
                        <option value="sky">Sky Blue</option>
                        <option value="black">Black</option>
                        <option value="green">Green</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2">Text Size:</label>
                    <input id="textSize" type="range" min="12" max="20" value="16" class="w-full" onchange="changeTextSize()">
                </div>
                <div>
                    <button onclick="downloadBackup()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 hover-scale flex items-center">
                        <i class="fas fa-download premium-icon"></i>
                        Download Backup
                    </button>
                    <input id="backupFile" type="file" accept=".json" class="hidden" onchange="restoreBackup()">
                    <button onclick="document.getElementById('backupFile').click()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 hover-scale mt-2 flex items-center">
                        <i class="fas fa-upload premium-icon"></i>
                        Restore Backup
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-green-700 text-white p-4 flex justify-around fixed bottom-0 w-full shadow-md">
        <button onclick="showPage('homePage')" class="flex flex-col items-center hover:bg-green-800 p-2 rounded hover-scale">
            <i class="fas fa-briefcase premium-icon"></i>
            <span class="text-sm">Cases</span>
        </button>
        <button onclick="showPage('workbookPage')" class="flex flex-col items-center hover:bg-green-800 p-2 rounded hover-scale">
            <i class="fas fa-book-open premium-icon"></i>
            <span class="text-sm">Workbook</span>
        </button>
        <button onclick="showPage('assistantPage')" class="flex flex-col items-center hover:bg-green-800 p-2 rounded hover-scale">
            <i class="fas fa-robot premium-icon"></i>
            <span class="text-sm">AI Assistant</span>
        </button>
        <button onclick="showPage('settingsPage')" class="flex flex-col items-center hover:bg-green-800 p-2 rounded hover-scale">
            <i class="fas fa-sliders-h premium-icon"></i>
            <span class="text-sm">Settings</span>
        </button>
    </nav>

    <script>
        let cases = JSON.parse(localStorage.getItem('cases')) || [];
        let currentCaseId = null;
        const GEMINI_API_KEY = 'AIzaSyC151MOHgFcc-xUuXPCV860AfhgA9EyN5o';
        let currentLanguage = 'en';
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
        let currentChatId = null;
        let currentFilter = 'all';
        let hearings = JSON.parse(localStorage.getItem('hearings')) || {};

        function showPage(pageId) {
            const pages = ['homePage', 'caseDetailsPage', 'workbookPage', 'assistantPage', 'settingsPage'];
            pages.forEach(p => document.getElementById(p).classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            document.getElementById(pageId).classList.add('slide-up');
            setTimeout(() => document.getElementById(pageId).classList.remove('slide-up'), 500);
            if (pageId === 'assistantPage') {
                displayChatHistory();
                displayOldChats();
            }
            if (pageId === 'homePage') {
                filterCases(currentFilter);
            }
        }

        function addCase() {
            const caseTitle = document.getElementById('caseTitle').value;
            const caseNumber = document.getElementById('caseNumber').value;
            const court = document.getElementById('court').value;
            const clientName = document.getElementById('clientName').value;
            const caseDate = document.getElementById('caseDate').value;
            const caseStatus = document.getElementById('caseStatus').value;
            const nextHearing = document.getElementById('nextHearing').value;
            const hearingTime = document.getElementById('hearingTime').value;
            const caseDescription = document.getElementById('caseDescription').value;
            const caseDocuments = document.getElementById('caseDocuments').files;

            if (caseTitle && caseNumber && court && clientName && caseDate) {
                const caseData = {
                    id: Date.now(),
                    caseTitle,
                    caseNumber,
                    court,
                    clientName,
                    caseDate,
                    caseStatus,
                    nextHearing,
                    hearingTime,
                    caseDescription,
                    documents: Array.from(caseDocuments).map(file => file.name),
                    createdOn: new Date().toLocaleDateString(),
                    lastUpdated: new Date().toLocaleDateString()
                };
                cases.push(caseData);
                localStorage.setItem('cases', JSON.stringify(cases));
                displayCases();
                clearForm();
                showPage('homePage');
            } else {
                alert(currentLanguage === 'hi' ? 'कृपया सभी आवश्यक क्षेत्रों को भरें।' : 'Please fill in all required fields.');
            }
        }

        function filterCases(filter) {
            currentFilter = filter;
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-button[onclick="filterCases('${filter}')"]`).classList.add('active');

            let filteredCases = [];
            if (filter === 'active') {
                filteredCases = cases.filter(c => c.caseStatus === 'Pending' || c.caseStatus === 'In Progress');
            } else if (filter === 'closed') {
                filteredCases = cases.filter(c => c.caseStatus === 'Closed');
            } else {
                filteredCases = [...cases];
            }
            displayCases(filteredCases);
        }

        function displayCases(filteredCases = cases) {
            const caseList = document.getElementById('caseList');
            caseList.innerHTML = '';
            if (filteredCases.length === 0) {
                caseList.innerHTML = `<p class="text-gray-500">${currentLanguage === 'hi' ? 'कोई मामले नहीं मिले।' : 'No cases found.'}</p>`;
                return;
            }
            filteredCases.forEach(c => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'card case-item';
                caseDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-medium">${c.caseTitle}</h3>
                            <p>Case No: ${c.caseNumber}</p>
                            <p>Client: ${c.clientName}</p>
                            <p>Court: ${c.court}</p>
                        </div>
                        <span class="status-active">${c.caseStatus}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">Upcoming: ${c.nextHearing ? new Date(c.nextHearing + ' ' + (c.hearingTime || '00:00')).toLocaleString() : 'N/A'}</p>
                `;
                caseDiv.onclick = () => showCaseDetails(c.id);
                caseList.appendChild(caseDiv);
            });
        }

        function showCaseDetails(id) {
            const caseData = cases.find(c => c.id === id);
            if (caseData) {
                currentCaseId = id;
                const caseDetailsContent = document.getElementById('caseDetailsContent');
                caseDetailsContent.innerHTML = `
                    <div class="card">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium">${caseData.caseTitle}</h3>
                            <span class="status-active">${caseData.caseStatus}</span>
                        </div>
                        <p>Case No: ${caseData.caseNumber}</p>
                        <p>Court: ${caseData.court}</p>
                        <p>Client: ${caseData.clientName}</p>
                        <p>Next Hearing: ${caseData.nextHearing ? new Date(caseData.nextHearing + ' ' + (caseData.hearingTime || '00:00')).toLocaleString() : 'N/A'}</p>
                        <p>Description: ${caseData.caseDescription || 'N/A'}</p>
                    </div>
                `;
                document.getElementById('createdOn').textContent = caseData.createdOn;
                document.getElementById('lastUpdated').textContent = caseData.lastUpdated;
                displayHearings(id);
                showPage('caseDetailsPage');
            }
        }

        function editCaseFromDetails() {
            const caseData = cases.find(c => c.id === currentCaseId);
            if (caseData) {
                document.getElementById('caseTitle').value = caseData.caseTitle;
                document.getElementById('caseNumber').value = caseData.caseNumber;
                document.getElementById('court').value = caseData.court;
                document.getElementById('clientName').value = caseData.clientName;
                document.getElementById('caseDate').value = caseData.caseDate;
                document.getElementById('caseStatus').value = caseData.caseStatus;
                document.getElementById('nextHearing').value = caseData.nextHearing;
                document.getElementById('hearingTime').value = caseData.hearingTime;
                document.getElementById('caseDescription').value = caseData.caseDescription;
                deleteCase(currentCaseId);
                showPage('workbookPage');
            }
        }

        function deleteCaseFromDetails() {
            if (confirm(currentLanguage === 'hi' ? 'क्या आप इस मामले को हटाना चाहते हैं?' : 'Are you sure you want to delete this case?')) {
                deleteCase(currentCaseId);
                delete hearings[currentCaseId];
                localStorage.setItem('hearings', JSON.stringify(hearings));
                showPage('homePage');
            }
        }

        function deleteCase(id) {
            cases = cases.filter(c => c.id !== id);
            localStorage.setItem('cases', JSON.stringify(cases));
            displayCases();
        }

        function clearForm() {
            document.getElementById('caseTitle').value = '';
            document.getElementById('caseNumber').value = '';
            document.getElementById('court').value = '';
            document.getElementById('clientName').value = '';
            document.getElementById('caseDate').value = '';
            document.getElementById('caseStatus').value = 'Pending';
            document.getElementById('nextHearing').value = '';
            document.getElementById('hearingTime').value = '';
            document.getElementById('caseDescription').value = '';
            document.getElementById('caseDocuments').value = '';
        }

        function addHearing() {
            const hearingDate = prompt(currentLanguage === 'hi' ? 'सुनवाई की तारीख दर्ज करें (YYYY-MM-DD HH:MM):' : 'Enter hearing date (YYYY-MM-DD HH:MM):');
            if (hearingDate) {
                if (!hearings[currentCaseId]) hearings[currentCaseId] = [];
                hearings[currentCaseId].push({ date: hearingDate, createdOn: new Date().toLocaleString() });
                localStorage.setItem('hearings', JSON.stringify(hearings));
                displayHearings(currentCaseId);
            }
        }

        function displayHearings(caseId) {
            const hearingList = document.getElementById('hearingList');
            const noHearings = document.getElementById('noHearings');
            hearingList.innerHTML = '';
            if (hearings[caseId] && hearings[caseId].length > 0) {
                noHearings.style.display = 'none';
                hearings[caseId].forEach((hearing, index) => {
                    const hearingDiv = document.createElement('div');
                    hearingDiv.className = 'card';
                    hearingDiv.innerHTML = `
                        <p>Upcoming: ${new Date(hearing.date).toLocaleString()}</p>
                        <p>Created on: ${hearing.createdOn}</p>
                        <button onclick="deleteHearing(${caseId}, ${index})" class="button button-red mt-2">Delete</button>
                    `;
                    hearingList.appendChild(hearingDiv);
                });
            } else {
                noHearings.style.display = 'block';
            }
        }

        function deleteHearing(caseId, index) {
            if (confirm(currentLanguage === 'hi' ? 'क्या आप इस सुनवाई को हटाना चाहते हैं?' : 'Are you sure you want to delete this hearing?')) {
                hearings[caseId].splice(index, 1);
                if (hearings[caseId].length === 0) delete hearings[caseId];
                localStorage.setItem('hearings', JSON.stringify(hearings));
                displayHearings(caseId);
            }
        }

        async function sendMessage(message, isCase = false) {
            const chatInput = document.getElementById('chatInput');
            const chatBox = document.getElementById('chatBox');
            if (message || chatInput.value.trim()) {
                const userMessage = message || chatInput.value.trim();
                if (!currentChatId) {
                    currentChatId = Date.now();
                    chatHistory.push({ id: currentChatId, messages: [] });
                }
                const currentChat = chatHistory.find(chat => chat.id === currentChatId);
                currentChat.messages.push({ role: 'user', content: userMessage, timestamp: new Date().toISOString() });
                chatBox.innerHTML += `<div class="chat-message user-message fade-in">${userMessage}</div>`;
                chatInput.value = '';
                chatBox.scrollTop = chatBox.scrollHeight;
                localStorage.setItem('chatHistory', JSON.stringify(chatHistory));

                try {
                    const context = currentChat.messages.map(m => `${m.role === 'user' ? 'User' : 'AI'}: ${m.content}`).join('\n');
                    let prompt = isCase 
                        ? `You are a legal assistant AI trained to help advocates by analyzing case briefs, legal issues, facts, and precedents. Input: ${userMessage}\nYour Task:\n1. Identify key legal issues involved.\n2. Break down relevant facts.\n3. Mention applicable laws or acts (Indian context, e.g., IPC, CPC, CrPC, Constitution).\n4. Suggest legal remedies or actions.\n5. Ask any follow-up questions if needed for clarification.\nReply in a clear, professional tone, as if you are briefing an advocate.\nFormat:\n- **Key Issues:**\n- **Relevant Facts:**\n- **Applicable Laws:**\n- **Possible Remedies:**\n- **Suggestions/Further Questions:**\nContext: ${context}`
                        : `Act like Gemini 2.0 Flash, created by Google, respond conversationally and assist with case-solving if applicable: ${userMessage}\nContext: ${context}`;
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + GEMINI_API_KEY, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                maxOutputTokens: 500,
                                temperature: 0.7
                            }
                        })
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}, message: ${await response.text()}`);
                    }
                    const data = await response.json();
                    if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                        let aiResponseText = data.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                        if (currentLanguage === 'hi') {
                            aiResponseText = translateToHindi(aiResponseText);
                        }
                        currentChat.messages.push({ role: 'ai', content: aiResponseText, timestamp: new Date().toISOString() });
                        chatBox.innerHTML += `<div class="chat-message ai-message fade-in">${aiResponseText}</div>`;
                        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                    } else {
                        chatBox.innerHTML += `<div class="chat-message ai-message fade-in">${currentLanguage === 'hi' ? 'त्रुटि: AI से कोई प्रतिक्रिया नहीं।' : 'Error: No response from AI.'}</div>`;
                    }
                } catch (error) {
                    chatBox.innerHTML += `<div class="chat-message ai-message fade-in">${currentLanguage === 'hi' ? 'त्रुटि: ' + error.message : 'Error: ' + error.message}</div>`;
                }
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        function displayChatHistory() {
            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML = '';
            const currentChat = chatHistory.find(chat => chat.id === currentChatId) || { messages: [] };
            currentChat.messages.forEach(msg => {
                chatBox.innerHTML += `<div class="chat-message ${msg.role === 'user' ? 'user-message' : 'ai-message'} fade-in">${msg.content}</div>`;
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function displayOldChats() {
            const oldChatsList = document.getElementById('oldChatsList');
            oldChatsList.innerHTML = '';
            chatHistory.forEach(chat => {
                const lastMessage = chat.messages[chat.messages.length - 1]?.content || 'No messages';
                const chatItem = document.createElement('div');
                chatItem.className = 'old-chat-item';
                chatItem.innerHTML = `<span>${lastMessage.substring(0, 30)}${lastMessage.length > 30 ? '...' : ''}</span> <span class="text-xs text-gray-500">${new Date(chat.messages[chat.messages.length - 1]?.timestamp || chat.id).toLocaleString()}</span>`;
                chatItem.onclick = () => restartChat(chat.id);
                oldChatsList.appendChild(chatItem);
            });
        }

        function restartChat(chatId) {
            currentChatId = chatId;
            displayChatHistory();
        }

        function translateToHindi(text) {
            const translations = {
                'Analyze': 'विश्लेषण करें',
                'Case': 'मामला',
                'Details': 'विवरण',
                'Client': 'क्लाइंट',
                'Date': 'दिनांक',
                'Status': 'स्थिति',
                'Next Hearing': 'अगली सुनवाई',
                'Description': 'विवरण',
                'Documents': 'दस्तावेज',
                'Error': 'त्रुटि',
                'No response from AI': 'AI से कोई प्रतिक्रिया नहीं',
                'Please provide case details': 'कृपया मामला विवरण प्रदान करें',
                'Please upload a document to scan': 'कृपया दस्तावेज़ अपलोड करें',
                'Indian law': 'भारतीय कानून',
                'suggest': 'सुझाव दें',
                'relevant': 'प्रासंगिक',
                'laws': 'कानून',
                'acts': 'अधिनियम',
                'sections': 'खंड',
                'actions': 'कार्रवाइयाँ',
                'under': 'के अंतर्गत',
                'Respond': 'प्रतिक्रिया करें',
                'conversationally': 'संवादात्मक रूप से',
                'assist': 'सहायता करें',
                'with': 'के साथ',
                'case-solving': 'मामला हल करना',
                'Hello': 'नमस्ते',
                'How': 'कैसे',
                'can': 'सकता',
                'I': 'मैं',
                'help': 'मदद',
                'you': 'आप',
                'today': 'आज',
                'Section': 'धारा',
                'Act': 'कानून',
                'Law': 'कानून',
                'Key Issues': 'मुख्य मुद्दे',
                'Relevant Facts': 'प्रासंगिक तथ्य',
                'Applicable Laws': 'प्रासंगिक कानून',
                'Possible Remedies': 'संभावित उपाय',
                'Suggestions/Further Questions': 'सुझाव/अतिरिक्त प्रश्न',
                'Title': 'शीर्षक',
                'Number': 'नंबर',
                'Court': 'कोर्ट',
                'Case Date': 'मामला तिथि',
                'Created on': 'बनाया गया',
                'Last updated': 'अंतिम अपडेट',
                'Hearings': 'सुनवाइयाँ',
                'No hearings recorded yet. Add one to track the progress of the case.': 'अभी तक कोई सुनवाई दर्ज नहीं की गई। प्रगति को ट्रैक करने के लिए एक जोड़ें।',
                'Hearing Time': 'सुनवाई का समय',
                'Next Hearing Date': 'अगली सुनवाई की तारीख'
            };
            return text.split(' ').map(word => {
                const lowerWord = word.toLowerCase();
                return translations[lowerWord] || translations[word] || word;
            }).join(' ');
        }

        function changeLanguage() {
            currentLanguage = document.getElementById('language').value;
            if (currentLanguage === 'hi') {
                document.querySelector('h1').textContent = 'वकील सहायक';
                document.querySelector('#workbookPage h2').textContent = 'मामला कार्यपुस्तिका';
                document.querySelector('#assistantPage h2').textContent = 'एआई केस सहायक';
                document.querySelector('#homePage h2').textContent = 'मामला इतिहास';
                document.querySelector('#caseDetailsPage h2').textContent = 'मामला विवरण';
                document.querySelector('#settingsPage h2').textContent = 'सेटिंग्स';
                document.querySelectorAll('.label-above')[0].textContent = 'मामले का शीर्षक';
                document.querySelectorAll('.label-above')[1].textContent = 'मामले का नंबर';
                document.querySelectorAll('.label-above')[2].textContent = 'कोर्ट';
                document.querySelectorAll('.label-above')[3].textContent = 'क्लाइंट का नाम';
                document.querySelectorAll('.label-above')[4].textContent = 'मामला तिथि';
                document.querySelectorAll('.label-above')[5].textContent = 'स्थिति';
                document.querySelectorAll('.label-above')[6].textContent = 'अगली सुनवाई की तारीख';
                document.querySelectorAll('.label-above')[7].textContent = 'सुनवाई का समय';
                document.querySelectorAll('.label-above')[8].textContent = 'विवरण';
                document.querySelectorAll('.label-above')[9].textContent = 'दस्तावेज';
                document.getElementById('chatInput').placeholder = 'अपना संदेश या मामला विवरण टाइप करें...';
                document.querySelectorAll('nav button span')[0].textContent = 'मामले';
                document.querySelectorAll('nav button span')[1].textContent = 'कार्यपुस्तिका';
                document.querySelectorAll('nav button span')[2].textContent = 'एआई सहायक';
                document.querySelectorAll('nav button span')[3].textContent = 'सेटिंग्स';
                document.getElementById('noHearings').textContent = translateToHindi('No hearings recorded yet. Add one to track the progress of the case.');
                displayChatHistory();
            } else {
                document.querySelector('h1').textContent = 'Advocate Assistant';
                document.querySelector('#workbookPage h2').textContent = 'Case Workbook';
                document.querySelector('#assistantPage h2').textContent = 'AI Case Assistant';
                document.querySelector('#homePage h2').textContent = 'Case History';
                document.querySelector('#caseDetailsPage h2').textContent = 'Case Details';
                document.querySelector('#settingsPage h2').textContent = 'Settings';
                document.querySelectorAll('.label-above')[0].textContent = 'Case Title';
                document.querySelectorAll('.label-above')[1].textContent = 'Case Number';
                document.querySelectorAll('.label-above')[2].textContent = 'Court';
                document.querySelectorAll('.label-above')[3].textContent = 'Client Name';
                document.querySelectorAll('.label-above')[4].textContent = 'Case Date';
                document.querySelectorAll('.label-above')[5].textContent = 'Status';
                document.querySelectorAll('.label-above')[6].textContent = 'Next Hearing Date';
                document.querySelectorAll('.label-above')[7].textContent = 'Hearing Time';
                document.querySelectorAll('.label-above')[8].textContent = 'Case Description';
                document.querySelectorAll('.label-above')[9].textContent = 'Documents';
                document.getElementById('chatInput').placeholder = 'Type your message or case details...';
                document.querySelectorAll('nav button span')[0].textContent = 'Cases';
                document.querySelectorAll('nav button span')[1].textContent = 'Workbook';
                document.querySelectorAll('nav button span')[2].textContent = 'AI Assistant';
                document.querySelectorAll('nav button span')[3].textContent = 'Settings';
                document.getElementById('noHearings').textContent = 'No hearings recorded yet. Add one to track the progress of the case.';
                displayChatHistory();
            }
            displayCases();
            if (currentCaseId) {
                showCaseDetails(currentCaseId);
            }
        }

        function changeTheme() {
            const theme = document.getElementById('theme').value;
            const body = document.getElementById('body');
            const textColor = theme === 'black' ? '#fff' : '#000';
            body.style.backgroundColor = theme === 'white' ? '#ffffff' :
                theme === 'red' ? '#ff0000' :
                theme === 'blue' ? '#0000ff' :
                theme === 'orange' ? '#ffa500' :
                theme === 'sky' ? '#87ceeb' :
                theme === 'black' ? '#000000' :
                theme === 'green' ? '#008000' : '#f5f4f0';
            body.style.color = textColor;
            document.querySelectorAll('input, textarea, select').forEach(element => {
                element.style.color = textColor;
            });
            document.querySelectorAll('input[type="date"], input[type="time"]').forEach(element => {
                element.style.color = textColor;
                element.style.caretColor = textColor;
            });
        }

        function changeTextSize() {
            const size = document.getElementById('textSize').value + 'px';
            document.body.style.fontSize = size;
        }

        function downloadBackup() {
            const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify({ cases, chatHistory, hearings }));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute('href', dataStr);
            downloadAnchorNode.setAttribute('download', 'backup_' + new Date().toLocaleString() + '.json');
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            document.body.removeChild(downloadAnchorNode);
        }

        function restoreBackup() {
            const file = document.getElementById('backupFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = JSON.parse(e.target.result);
                    cases = data.cases || [];
                    chatHistory = data.chatHistory || [];
                    hearings = data.hearings || {};
                    localStorage.setItem('cases', JSON.stringify(cases));
                    localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
                    localStorage.setItem('hearings', JSON.stringify(hearings));
                    displayCases();
                    displayOldChats();
                    if (currentChatId) displayChatHistory();
                    alert(currentLanguage === 'hi' ? 'बैकअप सफलतापूर्वक पुनर्स्थापित किया गया।' : 'Backup restored successfully.');
                };
                reader.readAsText(file);
            }
        }

        document.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', function(e) {
                const icon = this.querySelector('.premium-icon');
                if (icon) {
                    icon.classList.add('click-pulse');
                    setTimeout(() => icon.classList.remove('click-pulse'), 300);
                }
            });
        });

        displayCases();
        showPage('homePage');
    </script>
</body>
</html>